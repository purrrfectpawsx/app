# Story 1.1: User Registration with Email/Password

Status: ready-for-dev

## Story

As a pet owner,
I want to create an account using my email and password,
So that I can securely access my pet's data from any device.

## Acceptance Criteria

1. Signup form displays email, password, confirm password, and name fields
2. Password validation enforces: minimum 8 characters, 1 uppercase, 1 number
3. Duplicate email addresses rejected with clear error message
4. Successful registration creates user in Supabase Auth and profiles table
5. User redirected to email verification prompt after signup
6. Form validation provides real-time feedback (invalid email, password mismatch)

## Tasks / Subtasks

- [ ] Task 1: Set up Supabase project and initialize client (AC: #4)
  - [ ] Create Supabase project or use existing
  - [ ] Install @supabase/supabase-js package
  - [ ] Create src/lib/supabase.ts with client configuration
  - [ ] Set up environment variables for Supabase URL and anon key

- [ ] Task 2: Create profiles table with RLS policies (AC: #4)
  - [ ] Write SQL migration for profiles table (id, email, name, created_at, subscription_tier)
  - [ ] Create RLS policy: users can only read/write their own profile
  - [ ] Set up foreign key constraint to auth.users table
  - [ ] Test RLS policies work correctly

- [ ] Task 3: Create authentication context (AC: #4, #5)
  - [ ] Create src/contexts/AuthContext.tsx with auth state
  - [ ] Implement useAuth hook for consuming context
  - [ ] Handle Supabase auth state changes (onAuthStateChange)
  - [ ] Provide auth methods: signUp, signIn, signOut

- [ ] Task 4: Create Zod validation schema (AC: #2, #6)
  - [ ] Create src/schemas/auth.ts
  - [ ] Define signupSchema with email, password, confirmPassword, name
  - [ ] Add password rules: min 8 chars, 1 uppercase, 1 number
  - [ ] Add email format validation
  - [ ] Add password confirmation matching validation

- [ ] Task 5: Build SignupForm component (AC: #1, #2, #6)
  - [ ] Create src/components/auth/SignupForm.tsx
  - [ ] Integrate React Hook Form with Zod schema
  - [ ] Add form fields: email, password, confirmPassword, name
  - [ ] Implement real-time validation feedback
  - [ ] Add loading state during submission
  - [ ] Style with Tailwind CSS and shadcn/ui components

- [ ] Task 6: Implement signup logic (AC: #3, #4, #5)
  - [ ] Call Supabase auth.signUp() on form submission
  - [ ] Handle duplicate email error (catch and display)
  - [ ] Create profile entry after successful auth signup
  - [ ] Redirect to email verification prompt page
  - [ ] Display success message

- [ ] Task 7: Create AuthLayout component (AC: #1)
  - [ ] Create src/components/auth/AuthLayout.tsx
  - [ ] Add branding/logo
  - [ ] Create responsive layout (centered card on mobile)
  - [ ] Add footer with links (terms, privacy)

- [ ] Task 8: Create signup page and routing (AC: #1, #5)
  - [ ] Create src/pages/SignupPage.tsx
  - [ ] Wrap SignupForm in AuthLayout
  - [ ] Configure React Router route for /signup
  - [ ] Add link to login page ("Already have an account?")

- [ ] Task 9: Add error handling and user feedback (AC: #3, #6)
  - [ ] Display validation errors inline
  - [ ] Show toast/alert for API errors
  - [ ] Handle network errors gracefully
  - [ ] Add loading spinner during submission

- [ ] Task 10: Testing and validation (All ACs)
  - [ ] Test successful signup flow
  - [ ] Test duplicate email rejection
  - [ ] Test password validation rules
  - [ ] Test real-time form validation
  - [ ] Test redirect to verification prompt
  - [ ] Test responsive design on mobile

## Dev Notes

### Technical Stack

**Frontend:**
- React 18 with Vite for fast development
- React Router v6 for client-side routing
- React Hook Form + Zod for type-safe form validation
- shadcn/ui components (built on Radix UI + Tailwind CSS)
- Tailwind CSS for styling

**Backend:**
- Supabase BaaS (PostgreSQL + Auth + Storage)
- Supabase Auth for user authentication
- Row Level Security (RLS) for data isolation

**Key Libraries:**
- `@supabase/supabase-js` - Supabase client
- `react-hook-form` - Form state management
- `zod` - Schema validation
- `@hookform/resolvers` - React Hook Form + Zod integration

### Architecture Patterns

**Authentication Flow:**
1. User submits signup form
2. Frontend validates with Zod schema (real-time feedback)
3. Call Supabase `auth.signUp()` with email and password
4. Supabase creates user in auth.users table
5. Frontend creates corresponding profile in profiles table
6. Redirect user to email verification prompt page
7. User clicks verification link in email (handled by Supabase)

**Context API for Auth State:**
- AuthContext provides global authentication state
- Wraps entire app in provider
- Components use useAuth() hook to access auth methods and user state
- Listens to Supabase auth state changes via onAuthStateChange

**Database Schema:**
```sql
-- profiles table (complementary to auth.users)
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT NOT NULL,
  name TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  subscription_tier TEXT DEFAULT 'free' CHECK (subscription_tier IN ('free', 'premium'))
);

-- RLS policies
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can read own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can insert own profile"
  ON profiles FOR INSERT
  WITH CHECK (auth.uid() = id);

CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = id);
```

### Project Structure Notes

**Expected File Structure:**
```
src/
├── components/
│   └── auth/
│       ├── SignupForm.tsx        # Main signup form component
│       └── AuthLayout.tsx        # Layout wrapper for auth pages
├── contexts/
│   └── AuthContext.tsx           # Global auth state management
├── lib/
│   └── supabase.ts               # Supabase client initialization
├── pages/
│   └── SignupPage.tsx            # Signup route page
├── schemas/
│   └── auth.ts                   # Zod validation schemas
└── App.tsx                       # Root component with router
```

**shadcn/ui Components Needed:**
- Form components (Input, Label, Button)
- Card component for auth layout
- Toast/Alert for error messages

### Validation Rules

**Password Requirements:**
- Minimum 8 characters
- At least 1 uppercase letter (A-Z)
- At least 1 number (0-9)
- Confirm password must match password

**Zod Schema Example:**
```typescript
const signupSchema = z.object({
  name: z.string().min(1, "Name is required"),
  email: z.string().email("Invalid email address"),
  password: z
    .string()
    .min(8, "Password must be at least 8 characters")
    .regex(/[A-Z]/, "Password must contain at least 1 uppercase letter")
    .regex(/[0-9]/, "Password must contain at least 1 number"),
  confirmPassword: z.string()
}).refine((data) => data.password === data.confirmPassword, {
  message: "Passwords don't match",
  path: ["confirmPassword"]
});
```

### Error Handling

**Duplicate Email:**
- Supabase returns error when email already exists
- Catch error and display user-friendly message: "An account with this email already exists"
- Provide link to login page

**Network Errors:**
- Show toast notification: "Unable to connect. Please check your internet connection"
- Provide retry button

**Validation Errors:**
- Display inline below each field (real-time as user types)
- Prevent form submission until all validations pass

### Performance Considerations

- Form validation is client-side (fast feedback)
- Loading spinner during API call (perceived performance)
- Optimistic UI: Assume success and handle errors gracefully
- Target: Form submission completes in <60 seconds (per PRD)

### Security Notes

- Passwords never stored in plain text (Supabase handles hashing)
- HTTPS-only communication (enforced by Vercel)
- XSS protection via React's built-in escaping
- CSRF protection via SameSite cookies
- Rate limiting on auth endpoints (Supabase built-in: 60 req/min per IP)

### Testing Strategy

**Manual Testing Checklist:**
- [ ] Successful signup with valid credentials
- [ ] Duplicate email rejection
- [ ] Password validation (too short, missing uppercase, missing number)
- [ ] Confirm password mismatch
- [ ] Real-time validation feedback
- [ ] Email format validation
- [ ] Empty field validation
- [ ] Loading state during submission
- [ ] Redirect to verification prompt
- [ ] Responsive design on mobile (minimum 640px width)

### References

**Source Documents:**
- [Source: docs/epics.md#Story-1.1] - Story description and acceptance criteria
- [Source: docs/PRD.md#FR-1.1] - Functional requirements for user registration
- [Source: docs/PRD.md#Web-App-Specific-Requirements] - Technical stack details
- [Source: docs/epics.md#Epic-1] - Epic context and technical notes

**External Documentation:**
- Supabase Auth Documentation: https://supabase.com/docs/guides/auth
- React Hook Form: https://react-hook-form.com/
- Zod Validation: https://zod.dev/
- shadcn/ui: https://ui.shadcn.com/

### Dependencies

**Prerequisite Stories:**
- None - This is the foundational story for Epic 1

**Blocks Stories:**
- Story 1.2: Email Verification Flow (requires signup to exist)
- Story 1.3: User Login (requires signup to create users)
- All subsequent stories (authentication is foundational)

### Implementation Notes

**First-Time Setup:**
1. Initialize Vite + React project (if not already done)
2. Install dependencies: Supabase client, React Hook Form, Zod, shadcn/ui
3. Set up Supabase project and obtain API keys
4. Configure environment variables
5. Create profiles table in Supabase

**Development Approach:**
- Start with Supabase setup (database and client)
- Build AuthContext for state management
- Create validation schema
- Build UI components (form and layout)
- Integrate API calls
- Test thoroughly with various inputs

**Common Pitfalls:**
- Don't forget to create profile entry after auth.signUp()
- Handle async errors properly (try-catch blocks)
- Ensure RLS policies are enabled (or signup will fail)
- Test with email verification disabled in Supabase settings initially (for faster dev)

## Dev Agent Record

### Context Reference

- [Story Context](1-1-user-registration-with-email-password.context.xml) - Generated 2025-11-03

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List
